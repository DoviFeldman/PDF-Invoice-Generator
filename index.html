<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .form-section {
            padding: 30px;
            background: #f8fafc;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .download-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .edit-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }

        .preview-section {
            padding: 30px;
            border-top: 2px solid #e5e7eb;
        }

        .invoice-preview {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 40px;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4f46e5;
        }

        .invoice-title {
            font-size: 2.5em;
            color: #4f46e5;
            font-weight: 700;
        }

        .invoice-date {
            color: #6b7280;
            font-size: 1.1em;
        }

        .invoice-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .detail-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4f46e5;
        }

        .detail-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 1.1em;
            color: #1f2937;
            line-height: 1.5;
        }

        .amount-section {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
        }

        .amount-label {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .amount-value {
            font-size: 3em;
            font-weight: 700;
        }

        .payment-section {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .html-editor {
            width: 100%;
            height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            resize: vertical;
        }

        .save-template-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .invoice-details {
                grid-template-columns: 1fr;
            }
            
            .invoice-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .amount-value {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Invoice Generator</h1>
            <p>Create professional invoices instantly</p>
        </div>

        <div class="form-section">
            <div class="form-group">
                <label for="billTo">Bill To:</label>
                <input type="text" id="billTo" name="billTo" placeholder="Client Name or Company" autocomplete="organization">
            </div>

            <div class="form-group">
                <label for="service">Service/Description:</label>
                <textarea id="service" name="service" rows="3" placeholder="Description of services provided" autocomplete="off"></textarea>
            </div>

            <div class="form-group">
                <label for="amount">Amount Due:</label>
                <input type="text" id="amount" name="amount" placeholder="$0.00" autocomplete="transaction-amount">
            </div>

            <div class="form-group">
                <label for="payment">Payment Instructions:</label>
                <textarea id="payment" name="payment" rows="3" placeholder="Payment method and instructions" autocomplete="off"></textarea>
            </div>

            <div class="form-group">
                <label for="from">From:</label>
                <input type="text" id="from" name="from" placeholder="Your Name or Company" autocomplete="name">
            </div>

            <div class="buttons">
                <button class="download-btn" onclick="downloadPDF()">Download PDF</button>
                <button class="edit-btn" onclick="openHTMLEditor()">Edit HTML Template</button>
            </div>
        </div>

        <div class="preview-section">
            <h2 style="margin-bottom: 20px; color: #374151;">Preview</h2>
            <div class="invoice-preview" id="invoicePreview">
                <div class="invoice-header">
                    <div class="invoice-title">INVOICE</div>
                    <div class="invoice-date" id="currentDate"></div>
                </div>

                <div class="invoice-details">
                    <div class="detail-section">
                        <div class="detail-label">Bill To</div>
                        <div class="detail-value" id="previewBillTo">Client Name</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">From</div>
                        <div class="detail-value" id="previewFrom">Your Name</div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">Service Description</div>
                    <div class="detail-value" id="previewService">Service details will appear here</div>
                </div>

                <div class="amount-section">
                    <div class="amount-label">Amount Due</div>
                    <div class="amount-value" id="previewAmount">$0.00</div>
                </div>

                <div class="payment-section">
                    <div class="detail-label">Payment Instructions</div>
                    <div class="detail-value" id="previewPayment">Payment instructions will appear here</div>
                </div>
            </div>
        </div>
    </div>

    <!-- HTML Editor Modal -->
    <div class="modal" id="htmlModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit HTML Template</h2>
                <button class="close-btn" onclick="closeHTMLEditor()">Close</button>
            </div>
            <p style="margin-bottom: 15px; color: #6b7280;">
                Use these placeholders in your HTML: {{billTo}}, {{service}}, {{amount}}, {{payment}}, {{from}}, {{currentDate}}
            </p>
            <textarea class="html-editor" id="htmlEditor"></textarea>
            <button class="save-template-btn" onclick="saveTemplate()">Save Template</button>
        </div>
    </div>

    <script>
        // Default HTML template
        let htmlTemplate = `
            <div class="invoice-header">
                <div class="invoice-title">INVOICE</div>
                <div class="invoice-date">{{currentDate}}</div>
            </div>

            <div class="invoice-details">
                <div class="detail-section">
                    <div class="detail-label">Bill To</div>
                    <div class="detail-value">{{billTo}}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">From</div>
                    <div class="detail-value">{{from}}</div>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-label">Service Description</div>
                <div class="detail-value">{{service}}</div>
            </div>

            <div class="amount-section">
                <div class="amount-label">Amount Due</div>
                <div class="amount-value">{{amount}}</div>
            </div>

            <div class="payment-section">
                <div class="detail-label">Payment Instructions</div>
                <div class="detail-value">{{payment}}</div>
            </div>
        `;

        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Update preview
        function updatePreview() {
            const billTo = document.getElementById('billTo').value || 'Client Name';
            const service = document.getElementById('service').value || 'Service details will appear here';
            const amount = '$' + (document.getElementById('amount').value || '0.00');
            const payment = document.getElementById('payment').value || 'Payment instructions will appear here';
            const from = document.getElementById('from').value || 'Your Name';

            document.getElementById('previewBillTo').textContent = billTo;
            document.getElementById('previewService').textContent = service;
            document.getElementById('previewAmount').textContent = amount;
            document.getElementById('previewPayment').textContent = payment;
            document.getElementById('previewFrom').textContent = from;
        }

        // Add event listeners
        document.addEventListener('DOMContentLoaded', function() {
            setCurrentDate();
            updatePreview();

            // Add input event listeners
            const inputs = ['billTo', 'service', 'amount', 'payment', 'from'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });
        });

        // Download PDF function
        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            
            // Create a temporary div with the filled template
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = fillTemplate();
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.width = '800px';
            tempDiv.style.padding = '40px';
            tempDiv.style.backgroundColor = 'white';
            tempDiv.style.fontFamily = 'Arial, sans-serif';
            
            // Add styles to temp div
            const style = document.createElement('style');
            style.textContent = `
                .invoice-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #4f46e5; }
                .invoice-title { font-size: 2.5em; color: #4f46e5; font-weight: 700; }
                .invoice-date { color: #6b7280; font-size: 1.1em; }
                .invoice-details { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
                .detail-section { background: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid #4f46e5; margin-bottom: 20px; }
                .detail-label { font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 0.9em; text-transform: uppercase; letter-spacing: 0.5px; }
                .detail-value { font-size: 1.1em; color: #1f2937; line-height: 1.5; }
                .amount-section { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; padding: 30px; border-radius: 12px; text-align: center; margin: 30px 0; }
                .amount-label { font-size: 1.2em; margin-bottom: 10px; opacity: 0.9; }
                .amount-value { font-size: 3em; font-weight: 700; }
                .payment-section { background: #f0fdf4; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981; }
            `;
            tempDiv.appendChild(style);
            
            document.body.appendChild(tempDiv);
            
            try {
                const canvas = await html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF();
                const imgWidth = 190;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 10;
                
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('invoice.pdf');
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                document.body.removeChild(tempDiv);
            }
        }

        // Fill template with current values
        function fillTemplate() {
            const billTo = document.getElementById('billTo').value || 'Client Name';
            const service = document.getElementById('service').value || 'Service details will appear here';
            const amount = document.getElementById('amount').value || '$0.00';
            const payment = document.getElementById('payment').value || 'Payment instructions will appear here';
            const from = document.getElementById('from').value || 'Your Name';
            const currentDate = document.getElementById('currentDate').textContent;

            return htmlTemplate
                .replace(/\{\{billTo\}\}/g, billTo)
                .replace(/\{\{service\}\}/g, service)
                .replace(/\{\{amount\}\}/g, amount)
                .replace(/\{\{payment\}\}/g, payment)
                .replace(/\{\{from\}\}/g, from)
                .replace(/\{\{currentDate\}\}/g, currentDate);
        }

        // Open HTML editor
        function openHTMLEditor() {
            document.getElementById('htmlEditor').value = htmlTemplate;
            document.getElementById('htmlModal').style.display = 'block';
        }

        // Close HTML editor
        function closeHTMLEditor() {
            document.getElementById('htmlModal').style.display = 'none';
        }

        // Save template
        function saveTemplate() {
            htmlTemplate = document.getElementById('htmlEditor').value;
            
            // Update the preview with new template
            const filled = fillTemplate();
            document.getElementById('invoicePreview').innerHTML = filled;
            
            closeHTMLEditor();
            alert('Template saved successfully!');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('htmlModal');
            if (event.target === modal) {
                closeHTMLEditor();
            }
        }
    </script>
</body>
</html>
